from typing import *

from CipherUtils import *

print("Part A")
text = """
010000100000100100010111100101000010101110101011010100100110100110000110001000110110100010100001001101101000101010110001010000110010100011100001000010101110111110001100011010100110101000010000001101000001000001011100000101110001000100100010001011010111000000000101000010100101000001001000000100101101100100110000110100110111110000101011100110001011010010110100101000111101101100111100000010100001001101101011010010000010001000000100001000100001011000010011010000110001111010110001000010100111000001001011001100100100111110101100100010100011001101000001111001000100101100010000110000101101001011100100001010000000110001001010010100001011100110001011000010110011001010000110100001000001111000010110110000100100100010011000011010110000010010111000110001001010100000000000111010001111010011001111000100111100000010100100110010101100110110111000100111000100111100100101011000100110010010001010110001000101001010101110101000110101000101001010101110001011000010101001010010000110101011100010000000010000100000100001101010110100000010000011000010000010001000001010101100110011101000110100001010100100001001010001100010000110111101101011011100100000000011001110000001000101001100011100100000110011100100010000000011010110000000000001001010011110000000110000000010010110011110000110100001000100000001010011100110001000100101000110011111010101001011100101101001001000111101101101011010100001010010000000110101000100011001001010101101101100110001000010000010000000110011100010000010011110110100110001111010101010101000111110001011001000100000010001000000000001000100010110101110100000101011100001000001000011010110000100111100000010100110100000010011111010101111100110010010001100011010101011101000111101101011110011010110101111011000100010101100101011001110010010101100111100000110101000100100111100110001100010000110111101101011011100100000000011001111001001001001100101000011010110101100100001110000000110100000000000011010100010000010000010101001000100010001011110010000001100010000110100010010000110100100111100011000011100110011000001001001110001100101011000000010001001110000000010000001011011100101100000000011010100101001001010100101011110010010001101011010101111110010000110100010000010000100010010000001111011100010001011001010101000110001001010011000010100001010000010001001100110011110001000101000110010110000001011011010010100100101101101001011100110011010110101100010001101000001010001001010001010011110000000110011101011010001010000110011001001001001100101000011010110101100100001110000010011010100010010111000100000001011000100111100100101001001001010100001000010000010000100101010000001001010000101000101101000111110001011110100001100000101001110001011000010100011101110111101101100110101001100001001011001001010000101000101000010111110001000000011001100001101011011000000111000101011001000001000000100100101011000000101001110001001000111001101011001011000101010000110000010100111010100001100010001111000011001001101011101101010110100011110001011000000111100011000101100110000010010111000100000001010101100001011011010101100100100000101001011100010100011011110001000100011100110101011001000110000110011100010011000101001011000100100101000101011001001011101101000100000100010001001011000111100110101000101001011011111000000001001100010101111000000110001110100111000011100101101110000001011110000000011010110000000010100000010001010011110001000010001001100000111001000101100110010100000011111010100110000001100101011101000111110001001000111001101011001011000101010000010101011000011010110000010000101000101010011010110111001000110000010011100111101101100010100010110011011000010011001110101000101000010001110001000011010100010011100101000001011010110000110011100101010001000110101000101000010000100110001111000110001010010000001001001111000110001101110110000101001110010110010011000101110000011101100101011101000111110101100101001111000100110110001110101000101010010011100110100001100010101010010011100100000110001000001010110101000111110001001000111001101011001011000101010000110000010100110010010001100011010101011011110000100110001111010101100011101001101011100111100000110011100111001001001001001101100101011001110000100101010100010010011010100101010001010000010101000111110001100101000100011001010000010101100110101000110011100111000111011011010000010100100000110100001000001110100000010000001101100100001000110011010100111000000001001101000000101011000001010100110100010000111011000111010111010001011101000000010001001001000101011110010101110001100111000100110011000000001110101000101000101000010001110101011011011100100011110000100110001111100110000001100100000100010000101010000001010110011001001001010000000100100100001100110000101001100001000110000101100110100001100110011000000110000000010010110101000111110101011011011110001010001000000101101101010101001011001011100100011100101000010000110000110001000110001110010100110000110100000000110000010000100110010001011011100101010100001011000100100111000101011101000100000110100100010101010001010000110101011001010111000011100101101001001000010000010001010101110001000110101001100010111010100001101100110100101000010000100110001111100110000011011000010011001110101011000011001001110100000000110000010000100110010001011011000111001011110001000110000001011010001001011100101101100000101100110000111001001111000000001001001000100100001111010100101001100010000110001101000110011110010000011100100110001000100010000010000100000100100010111100100011110000101101011110011001111011110001101101010110101001100000111011000000100111100101011101010110000110100010111100110011100111000110011101001101111000010101010111100111100000010100110100010010001001100000010010111010110001101100001100010101001011000001101101010101001011000000100001000000100101000011010110000110011100001000010000010001110001000010101110001101000111110001000110010100000101011010010001011010101010000101000110001101011000100000010101001100110001000000101000010001000000100001000000100111000001100110010000010000100110001000011010101111001001010001100101111010100110001111010100000011111100100100010001010001100100100010010101100111100001010011110000000110011101011010001010000110010011101001000101111001000000011000001001000110011010011010110011000000100101010000011001111000100111010111000011010000100001101101000110001000110111100001101011010101111101010000001101100100110100010101111011000100010101010100001011111010110001011101011010001010000110011001001111000100001010101011010101011011010100001101000111110001100101000110000001101100100001011000101000101001010000001101011110011000010100100000001101011011010010100000010000001101011011010110101100000110000100010001010101011000110110010000000010010101010000100101110101100100011001100100110100011000001000111001101001011100100110100100010100101001010010000001100010000100010001000010010101100111100010010100110010001101100111001100101010011010110011100111100000010001010010100010010110010110000010010001110001100101011001100100100100000000110001001100101000011010110011001000100101010011111010110101100110010101111010011010110011101011100111001100100100000110010000010101011000011010110000100111010101010100000110000100000000101010010100100110001101011011010000100001011010110001100011000101001011000011010111001001010101101010011010110011101000100100000000011001111001010000101010001000011001010001100101000110000100000110001111010001000101001101000110011001011111010101111000011010010001011010101010001011110101100001100111100011000101000010000001100010000100011101011001111000100111100101010001010100000000000110110100010101110110000100001001011101001000010101100001001010101000101001010101000001011000011011000011100011001101011011010010001010000110010001101110011000010100100000110101100101010111000001100000110001100010100100010101100110000000100111010100010011100111100001101000100010000101110110001001001000100000010001110110000110100111100101011001110000110101100011010100001000011010110000000000100100010010010111010100100111010100010011100100000010011110100001100000010101010100001001010000110000100110010011000000010010001011110010000001011011010000010100101000010010101101010110100011110001011000000110001111000011100100010011001000101001100100110100001000001000101000101001011011101101011111010101111100110100100111100111010110011001011010100110101001000101001011000011000110001111010100011010011010101101010111001101100001110000100111100010010000010001000100000000000110101000101001011001101101100100101010001101011010001110010111010101111001100110011000010111100101011101001011000010010111000100000001010010010001001111000100001011010100000000000001011100010001000000100001001100001010010001010000110100001001001001111011111001010001011011001101100001110100101101000100000110001011110111010001100111100000010100100100000000000110110100110101000111101101011001100101001001001011100100011100101000010100110000100110001111010110001011111011100110101000100001011001010101100100000001100110000010011010110011000000011001001000010000110010011100100001010101011011100110001110100001100101010111010100100111100000010000110110000000100110100011000011001011110101010110001011000100100000100001011110100000010100110110000000100110101110000101111000000110001110101000101001010100100001011100000110100001010111101101000110100100010001011010101110110000101000101001011001110101001101100010001011110110100110001111010100010011100101100001100101001101100100000110010101100110110111000100110100101101001101011100010001000100000000000110100100010000110001000100001001010011000011100101110100000000100001111110010000100001011100000100110101000010010101100111100000101010011010000110001111010110000100000110001111010001000101001001101011000100000101010110000100110110001111101000100000010001000000110100001001010101011101001100101101011011001100010100110000100001100111100000010100110111101101000110010110100000011100101111001111100110011001010100000000000111100101001001010110100110100110010100100001010000100101011100001100010100111001110001001000011010100001011010010001100110101000101001011010110001101110101000001000010011000110011101011101100101000111100100011100101100100010000000110100001000011011000100000110000100100101100011000100101100101011001111000100001100110000101101100010101000010001001011000000100111100000010001000110001111100010111101101101000101100001010000010000100000011001111000100111100000010101010000000111000000001000000010000110001111010100100100011100100110000011101001010101011000110011001101011011000101001110010000010101100101100101011001000110001010011101011000000011111000000000000101100100001001011010101111001001000101011001000000000001011100010010001010000110010000010000100110001100101000001110101000101000110011111010100101101101010101111001011100110001010111000110001010010001110001010110111100011011000100000110100100010100110101000010001101100101001101001001010100000100010110111101011011110000101101100101100101010100001001110001000101000100001001011010100111100100010101111100110001001110100100101000110101000001000110010000010101011000111000000010001111010101111000011010110000101101010110000101000100000100100111010100001101001100101011010000010000100100111011011001001000010100011101000111110001010001010000010000010000001001001001100011000001000110100001101000010000001010011010101110010111000100000010110000001111011101010000010000101011000001010101100110001101001011000001010100101110000011001011000000001101010101111101000111101101011010110100010010000100010000001000111001101001010101000110001001010011001101010000101101001010101000010100100100010010001000110100001000010011000101101101010100101000010101100110001111010100010011100000110101100011010110000001010000110000001001001100110100000111110001100011010100001000011010110000001111000100001000100110010011101000010010001010000110001101011011000101001110010000010101100101100011000100101100101011001111000100001100111001110101001101100010001011000011010000010001011000011001011100110001011010101000110011100000110001100011010110000101000000010010100010010101010011010110010101101101000110000001100100000101000101100101011000010000110001000111001010110101000111110001010000010010000010010111010100100110100100110011100000100001000000010001100011000101110001100010110101100100101001110000101101100000110011000110010100000000100001111110010010001101100101011001100000110001000101100101010100001011111010101001001110111110001010000110000101001001010001100000110001011001001000010010001100111010010101001101100010001010000100001000001001000101011110010101000001011010101000010011011011100001100011000101111110010000010101001100010000110001101000001111000000010000000001010100100001100111100010001101011100100000001001010001100101010000100110011101001000010010011010000010011100100010001000011010100110001111100110000101001011000100110000001111000101000000110001100010100111000011100101101101100100001111000100100010100101000001100100001010010000100110001000010000001100110000100001100011010101101001010100000110010000101010000001011001110010011111010101111100111011000000000000001001001110011000001001011100101101001001000100110001100111100000010101110100000101011010101010001010000110010010010000100010000101001011110001100010100101100011100000100001100101000110110010010000101101011011010000101001010010000001011010101011001001010000110100001000001011000100110000101110101000101000011011111100100111100100101000101001011011100001010000010010001101110100000101100111100011000101000100000101101101010101111001010100010000011000010101111001010010010001000011010100100000011010100110011100100100010001010000110100001000011011000100100100011000010111010101001100110100110001100110110100010001011010101110010111000100000010110000001001011100100001001001000100000000000110010110010100101011001001011011000101011001001000000110101101000110000011101011000110000100010101010001101011000100100111000111001011000110000100001001000100001010011010110011101101100000010011100010010001001100010110001101001011000110001111010111001000010101010111011101011010001010000110001110011100010101000000011001111000000011010100000000011010010001000100001000010000011100100110001111010111001011111011010111101101000110000000010101000110101001000101001011000011001101000101100110011010011001100101001000100010011010010101010001100011010101101011111100100110011100010010001010000110000101001111000100001011110010001101100011001100101010010001110001000100001001100100111000000000001101100110001001001011001001011011000101011001000111010101101011100101011001111100110001000000100101100011100000001001001110111111001011000100001111010101100011000001000100110001001000010010001011111011000101101001001100000001010000000101001010101101001000011010110000001111100110000000010101000110010000110000110101001000010001100101100011000001000100101101000110001010110001000110000101100111000111001010011001110101100101010100001101000111110001000011000101001010110100000000100100101000101001011100110001011110010101111101000000100100000001001100010001000100010000010000100000010000110000111000010000010000010001101100100001011000101000101001010100100111010111011111000100101000001101011011001101111010010000010101100100101001100011000100000110001000100010001100100100010011001001010000110001010000010011010000110000010011100111110101100101010111000100101001101011001000010010001010000001000101010001000110000011010110100001100011100000110100111010110001101100001100010101000111100001000110100101100001100000010100000001010001100101110101110101011110001001100011010100001111110001100100101011111010110001100100101001001110010100110001010111100100010101100110010100001000010000010101100110000100011001010111000011100000100110011101001101100100110000100101011100001111000011100011011000010000110000010100110100100111100111100110001100110110010001011001010100001000111001110001000000100000011100101011011001100111100000010100100110000010011100100010001101000111101101100111001001001000010101010111100101100101011101000110000100001011010101111001011010101111001001100101011001101011000100001001100100100011100101100001011001010110000101001000001111011110010101001010010000110101000100100100101000010101110100000001010000001010011100110001000100010101011100110110000011101001010101011000110110000101010000101001001011111011010111001001010011000011001001100110011100010100011000011010010101010111100111000100100100000000000111100100011011110001000100001000010000010011011000010001100100110111000011100000110001000110101001100001001000000101000100100000010001001000000110101000100110100010000110000000101101010100000011111010000010010111000100110011100110010000000001001001100101010000100110001111010100110100101000000000100111010101111001100110000100001000010000000001011000000000000110010101010001010000000110010001001101101011111001110101100111100100000100110000110100001000010010001010000110000101001000011011000100000110000100100100110101100101011001110000000011010110001010000110010101000111010111000011001001000001011000011001111011111010001101100110001111000101000110000100010001000101001010010000111000011100010101000001010101111000010000000100010101110110001001001000100000010011100000110110101000100110001101101000001111100111100101010100111011010010100111100000010100110110000110000001001110001010010101000101101101010100101000010101110101011010110000010011100000110001000110100101100011010110000001001010101000101001011010010001100111100001100001000000000001101000100010000001011001101000001000100111001000010101010111010000010010001010000110000000010000010000010101000110010001011010101000101000110110000000100110101101111110010111101101100010100010110100000001000110011100101110001000011100110001100000101100010100110000110010011100100011000011100100011000110000100110001100110000100001101100010101111010111011000000100011010100000001011010100110100101100100100011100100011000100100101001111000010110110010010001001110001011110000010001001001100100011101000111110001100011010110100000010000001101011010111110001010001000000000001100101001100100110001010011001101010110000101000010010100011100110111000100111100110001100100011001100011100000010101000010001000010001101011000100100101010101011001001000000000001100001100010011111010100110001111010100101101011010100110001010010101111101000111110001010100010101010100001100100001011001000110001001101000011000001000100110001010000110000100001000110111000100111010100110011000101100000010000100000000000111001100010100100000101101010000010001001110011010100001100111100000110011100111000110011100001000110011101001010101100110101001100001101011000100001001100100100011100111000001101011010101111011101010010001011010101011000000110000110101011100010000110101000010001101100100011110010010010000110001011110010110000100111000001110010111010110001010000100000110100111100000110100110010001101100100101000101001010010000001100010000101100001101011000000001000010100011101000111110001000100100000110011011000000000000000001001011001010000101001011100100001000100110000110100000000101000101000010101110011100010010110100011100001000010000001011010001001011100100110001111010100011000011001111000011101011010001010000110000101011100110000110001010000100101011001000101111010110110000110011001000101011010011011100111010111000110001010011011000000010000100111000011000001001111100011000110001010010001110001000010101110000010011010110001100100100111000011100101101101100110101011000000111001000101011100010000100011110001110001100010010001010001011010100110000100100000010001001000001110010000001000110101000011001101100011010111000101100110000100110001010100011001100110001111100111100110011001010010001101110000101001100011011011001000001000110100101011111001110001011001000101111010110110000110100100101000101001010101100001000100101101010001011010100110100100100110001011111001110001011011011001111011111010000110001111010111000100100101010100010000110000010101110110000100001000100110001010011001111000011100101110001101000111110001100011010110000011111010010001101101100000010100100110001101011011010000110101000010001101100100011001100100110000010101000010001000010101000111101101100110101000101001010011001111011100010010001000011000000000001001010000010011101011000111001101100010001011110110011001000011000101111100100100000101100100101110000000100001000110100111100011000101000000010001001000001100010001000001000000010111100101000001011001101011101101100001100001010001110001100010110101111011110000110001100111100000010000111001100001100100101101111001011100110001011110010101111101000111101101000111001000010001011010100110001110010101111011110001010011001111000101011001001000000110000111100100001011100000100101001001010101010011001000010111001000001010110101000111110001110001100011000001001001110001001010101011000011100011000110001111100101011001111000011001011110010101111101000100000000100110010101011101000111110001100101100000010011000001110001100101001010010101000000110101011001010110100011110001011000000110101000010011001001110100000000100001111110010000010001100111000110100000010000101111001111100101011000110100000101001001000101011110010000110100010000010000100100110001000100001011000100000001010101101101011011010011000100111001010001000110001100010101001011010111001001010101101000011010110001110001010101100011100000110100001001001001001000010101010111011001000101111010110110000110100100101001100011110100000101010000100110010100111011110001000100101000010001000000110100001000100100101000010101100001101101000101111000110111110101101011010110001000010100111000001001000101101100000110001101100011010100001000011001110101100110101001001001011001101101100111010101111010011010110100010000100100101001010100010000100000101111000100100000110001100010100100011101011001111000110000100000010100110000100001100011010100001000011010110000010001000110000100110001011001001001010000000011111010000010010111010110001001011001101011000111100110000000011100111001001001010000110100100110000110101000100001011001010101100110011100101000101001011001110101000010100011000100100011000110011101011000110011101000000101001110101000101001011000100001000011100100101000010101100101100111000101111101000110010000000010101110001101110111110001011010101000101001010011000001001011011000010100100110010000011001010111000011100110001001000100010101011101001100101101000100101000110100100110010010101000100100010001001000010100000001010011000000100110000110100111010101111011110110110010001000100010001010000110000110000001001001001001010010001101100101100101011000011010100001001011011000110000110110000000001000111010001101001011010100000000100001111110010000001001010000101000101011010011000000000000001100010011111010100110001111010100001011111011000100
""".replace(" ", "").strip()
print(Vigenere.auto_decode(''.join(lc[int(text[i:i+5], 2)] for i in range(0, len(text), 5))))

"""
Split into 5 bits, take that letter of the alphabet, then Vigenere, key BINARY
harry had insisted we place the hole where it wouldnt be seen later, i was pretty sure now that he planned to claim the table for his office so he suggested we remove the makers nameplate, and drill. there it was, just as well he did, the demolition charge was linked to a web of mechanical detonators and almost any other direction would have disturbed at least one of them. the machinery was old and the sappers werent happy working with it, but mechanical mechanisms can be easier to work with than electronics as you can see how every thing is connected a judicious dose of superglue fixed most of the mechanisms in place just leaving us with the problem of what to do with a heap of old and unstable explosives normally we would have placed one or two of our own detonators and packed out the place with sandbags and breeze blocks to contain the explosion and i think even harry might have been convinced that that is what we should do in this case but unfortunately the explosives were not the only thing we could see inside the safe sitting under them was a slim black book we couldnt see any details but having got this far it seemed crazy to destroy it anything this well protected must have been important at sometime and we needed to know what this might all have been about after a quick callback to headquarters harry got approval to continue trying to crack the safe he knew me too well to ask me to leave but the documents team retreated to a safe distance down the corridor with most of the guards leaving a small team to watch over us as we worked one of them had joined the sas from the sappers and was an experienced bomb disposal expert so he worked with us watching the explosives for any changes monitoring vibration and temperature and generally keeping us calm it takes a special temperament to do that work full time and we were glad of the company and the expertise after seventeen hours we were getting tired and as eighteen approached i began to wonder if we would manage to save the papers but eventually the final cog turned and the last tumbler fell into place we had managed to glue the broken cog back together and with a mild protest the top turned raising a platform up through the central pillar to present us with the book we had seen by the light of the endoscope it was bagged and secured and harry took it with him the special forces secured the entrances to the shadow archive and i left to get some sleep we met the next day to go through the papers harry had started on the decrypt doing all the usual checks frequency analysis index of coincidence and soon the distributions were relatively flat so it was clearly not a simple cadenus or substitution cipher and we started trying some of the ideas we had found in blacks code book it took us longer than we had expected but after a few days we had the entire set deciphered and had begun the analysis harry had slightly different interests from me i was fascinated by the insights into an older world while harry was focussed on why these documents might have any contemporary significance both turned out to be important history matters and as marx said it tends to repeat itself personally i would bet he wasnt the first person to say it and he wont be the last but for us the point was that as we read more we began to see the parallels between blacks world and our own and it was not comfortable reading when we got to the back of the book all became clear the book was actually a civil service report on the shadow archive closing it down and giving reasons why black had been too successful and his activities had badly destabilised the balkans the report traced a direct line from the bulgarian crisis to later tragedies given his early enthusiasm for his new methods of shadow diplomacy i honestly believe he never meant to cost so many lives but it seemed clear from the report that blacks interference in foreign domestic politics had had dire consequences it looked all too familiar and if our enemies wanted to discredit us when we complained about their interference in domestic politics then these papers would be the ideal kompromat material it looked like we werent just victims of these tactics we had invented some of the methods ourselves back in the nineteenth century harry put out a request for analysts to work on recent signals traffic to see if there was anything to suggest who was responsible for sending me on the hunt for the kompromat files there wasnt much and certainly nothing to link it to foreign government action it was quite possible that this was the work of one of the criminal networks that had grown up after the fall of the soviets market manipulation is a lucrative business and attacks on government credibility area very effective way to move whole markets the documents stolen from the archive were still out there somewhere and it was possible that they contained enough to embarrass us but that seemed unlikely whoever wrote the closure report had been thorough and it didnt seem likely they had left anything important on the shelves but time would tell harry set a watch in case anything surfaced and asked me to keep an eye on the black markets too as i suspected the shadow archive table appeared a little later in his headquarters fully restored and i assumed completely disarmed i returned to the library to finish the job i had started but when they offered me a new contract i refused i had a better offer the table was in an office next to harrys with my name on the door
"""

print("Part B")
text = """
TSTJAN FP JON PVZDYPRFXTFEX, NQWKEJLOPJKHQ WYJ VZDEBRZB FG JON FXCOVE GADBJLI; KTNB TSGJYIKPUWATSUH. HCH CSST SHNF SUMN.
XFTV YFFCHD HCH ZCXYCWHDCYPZ IZ JON QSYFDKY FOJTSXGAT ZW IIZKMZ WE XFP VZTKGAOMKH TRI IDZJLLATOW WH XFP LSDQL-RZZKQSRIPJZ JEXNXGNISRMP YMFEGB, DXK HRWIKH CTZORWO, BFIIGQNKT IIPPMYFU XJ IV ZAS WHNXNXS. XFP MKQVVA NSUUTLYF MKEVQXPJEDJLJZV LWI WMDCFPQ GJZDKTELYR NBF TVMGCHF, TD KPGR DQ W EOITDIH JQ GKHQCYF GKDIRNJ WYWC WYIGDHDD JQ CZH TGATQNUDIE. TN CMQC MKJZDDRE I AYJSJ EOITDIH JQ NBF ZYHAOUU TDEPNW WH XFP YYERLOP YUO IIMKITFEBGDCFPQ WE DS ZAS YEP SY ODDZKVCM VJ AGSWF TDEPNW.
URI EGYEWX WHNXNXS LE IJ NPUIZPJEFEX RZNKMBLQPJJF TKNZDD HSX DS AD URI ZACHDJI EPDYFJWHC NF ASV XIEKHJH SOOKP LLMDSYJT LY DXK MTXN PCMAJINZNB ESRAOMD. JJ EGF OWUTFVTVBFU XJ NSUOKGA FPYXSLVXYUES WYJ NF ETVHC SSU ZCOPMZ ODTVKICUDG GNNNWED IPVNIEII DS LVIXFPM ZAS LYDOYFQXE KW BFI QGUOWUN’D QKQKTEQNZN, GADPN SMFXDBRZB CP SPNYOUU VJ ZXYSHDFVP ZKPDWLTGNUN LY DXK FLIYD NBDJ LAF YJUDZRDCKH XIHP ZNHZCOPMKO. QGGZN EWZYXPJZDJLJZ VZJBP NBCWUQ JHKI ZADD EDYMF VJ AGO KHJWLXCWACIYD SL URI GADBJLI, AGSSIR KRWOU URI IPGNETXN ZYZVII JQ CZH VTNAYZJVRE, TN TDN FN DXCU LIHC WKB QYMG ZFEKQNZNW BSVN PQKT XVRDNKP. JON QOG URWA JS YFCWRZ YYF YH YINSTS THTQCUS GJYISPDGGDCFPQ WYJ KKTQCYIG YFZCHJV.
NP FWHDCJVBWH DXKTS WZSOCTQ XJ GYHF YINZ Y JWIVNFKFPUIYNO IFJENPJ BFI QGUOWUN WYJ DBDIPNF BYFN GJZDKTELYR NBF EINJ WFT QYMG YU WIKGZCWDJLJZ, NBWKKF KJRZ T JNL SL URCEP GKUJIHF YYF VR PTGK JE XFP KYJLWAP MFZTP MKGRFZXRKJ. NU DD EOMTJQII DXCU VXFPM RFJXNAV JWEGNAJNPA XFP MKEIYRDIKPJ CP MGCEW WE DXK GDVED XKDU CP DXK DIGFTQK NKDA GYHF SSRFNKO, YYA IJ KPJLHP AFY VJ IKDSNSRAF WYWC XFIN VFILJJ CW NDDETJM BDXF ZS NPUIW QCRF JC APGR VQ EFIN NU ZCYDYNPSB. JOM NPLIEDCMDJLJZV NPJC LXYJL QOJL NBDJ ON LYW TSPGDOE UV KHPT, CPU XFIN BF IIAOMUFU JHKI IWQXJZ ICHQWMGPWFJXE DS ZDWI DS MKHDBNZDK JE PJZZFP. RLE TITFULGDO LDCLVC HKTS RJD HKDBXFC, NBWKKF GO BDU FNPJ C TSPGDCHFBH EODJFQDPOG JTDQRZYR JE XFP PUJJII FNCUSD, GZZ JWEXNYKFTTVB AOJWIBE FPMISDA DXCU RI FIZ KHJWLXCWASB RZZKQSRIPJZ NSWYF. JF TSGJAZ FG RLE PIVMVHXPJZ ETR LP WFVEB, FKHKXSV EPQKTTP JQ NBF SSAIJZ OVGDYOUUQ JHKI MTSH’E SOYHVRGX DFMBIMDCFP RLYD NBDJ FVIDQ BTD HPDYVDXNJ YW ASV XIEKHJH’E QCYHJ DNNMKU QIMAOZDIH, EK NBF TFEPJJF VJ GZT EWZYXPJZDJLJZ CW VEDDAKYJQLYR. ARDZN UPKZ D FIHFSUDB MJOMUDB EFTDB EVRAICUFU DJYO NPJIHPVZJEK IPNCJBD, QTQNPA YE FSTF DRETBBU DRAK XNH FIHFSUDBLAC, YUO DX RF DRFTV AGYZ AS XFACHFU CY IZHFEXDAO. SPHCHDPUDJIVC, NBF LCVOIKH IIVINNPA XJ GCW QSVRKZ NP BCYJSU DII GXVF NDDETJM, HV EN NYUPVX HPGD WE XFPI ZW HLVX CU URI XTVWJEK IPNCJBD JQ XNH IIMAPNUCIYD NF URI GADBJLI. YKJKURIVPVW D EYXMOY WH YYKWLJZLGX MKEVVIF ICJEXGTJKO YH XPIIFID JQ NBF HCHPCMP QIMAOZDIH’E JOVDIXXPJZ HKKQPVZ URWA DXK FMLEDOUES CP DXK DIGFTQK, BRLVP SLGDGRIGRZ UIYTOE, BTD UZSGP JC G FICMB RDYAKT VJ XPIIFID JQ NBF DRAPGRJAIYNO JWCQDZCZZ DR VKJEWE. LY SYYUDGDXYY URI NFNCCBLEGIKPJ CP GOCOGYGANKTQ LY FDFUBWYJ TCTU EGF Y YFBWATQKMN CZPJ WFZVND, KYFQYXIARZ YIMIPWF JON SSRJZI AGOTHSPOPV GFII GLYYF JOGD VFNSXFTJM VEYEOYR BTD QKCUI VR, AGSSIR XFP JCNS WYJ YJUDZRDCKH VJ AGO FTAWYTVCUDCY LOYF T GVKVKMN KDIMEFU DNNMKU. JON ZYTF QOGJSG DIGFTQK OVIE ZSZ DFTNIM FP TRB KWLJZLGX ZFEKQNZNW GICX DXK QSVRKZ. CH JON FDCMS CP MGCEW’D JSOYDJLJZV MTSE RZ NBF CLI PCMAJINZ VKXSRATOW, TKQJOMW WH LAF YJUDZRDCKH TPEK BYFX WYJ CZ HSIXF NF ATZN MOKP JORF, YW NKGF IV ZAS RNPZ ZW SDAIARJQO G FOJVII VKDCUDCY QSY ADD QASGJEK MKGRFZXRKJ FG DRAPGRJAIYNO VDFIHF, NBDJ DNPIW UV OGWO RFU FVIDQ UV XFP ZKXSPJSIKPJ CP DXK VEBNABYWKRI XYIZILYDX IFEIGDX ZAS HGAZ. ZAS IWDMCWIBRZYYZ ZCED SL URLE NSSMU RJD AK QICZPMRZ ZCYNOCMSB GZZ ZADD VPZ ZW GYNFNNWED RZ NBF RCDFO GADGF TJ ZVIR, RQ TFV XLVX OAEKDN DXK QKR, IASHF JON IMJADZN QPYURIH OJEFIKHKPUO. JOJFO MWLIHZIKPJ QRZCWUILNF HBJZO FIZ BJJONANF CSIY MOUFHLMTYYJSD JQ NBF DRAPGRJAIYNO EDJW GZZ CPTPBFCW QICIODKO YH LXYJL’Q CZPMCUDZNF JFB ZCXSGKUSPB JCWUTRMPZ ZASQEPGHFQ, WYJ XK HSIXF NF ATZN MOJWCI GZ YRNVDA PJZJIIVC WYFS WQPJZ, HSXATJM ADD JLJ VWBLATDCM TRI JCVMVQGDCJ IVWVF HNUR XFP NCEDX EOKVWIX JQ NBF FWVIDK. OKVRZB ZADD ZPMNWU, FVIDQ BTD PKDSHQII XYYISPB KJ EFQXGMCRJQLYR MSHQLGZ, BKTCWY IJE DKDAACCP DQZPMNDBLED OAQTRETSU JE XFP ACMWWYF MKIDCY, IJE WE XFP JKFU XJ SMFUSGA DXK NSBRDOYTTRNIJ ZTTBN ASSUSD. FP VKFCD AK XCXS BNWORWFII IJ KYJIYFCHF EIALSYL VJ GROUUQ LY DXK TSKRKJ, IVJ QJAO NNFCHDYUUBH AK XCXS BNWORWFII ZOG NSXFKZW WH EJAFNPA. EFTGK EBWEFCJDB BRSGFNTGB GYE DBEGCV YFBLNJ SU FQTRKJCIS, FVIDQ FQXGMGNHRII ZOG EVZNAN TFJOJJV ZW ULEAPVU JON JCVMVQGDCJ DZXRWCZJSD JQ KFUSRATYR WFTJFCZJVR, LC KRDZLYR YMFEXE LCZADR AGONT YYHPYSEIWMTOW. EVRAASRMDRQ DXK DAIYJY FG DQZKMZDEX RZNKTEWATSUDB QNPNNPAD, FP HCH TFVP, YZ MSWED CU QTVA, DS JWEXHKG ZAS CDDDFNS CP ZOMWJLGDCFPQ, WYJ NF CSRNQCZ GICX TJWJUI UZSGMSBQP SL URCEP ZKMDFNAYZJVRE. GO BDU TGANNEKPGA VSEZIEF ZSTDRQ DXK QSVRKZ FG JON MPRITVRIJ CPU FGXFCPQ GHTVKH ULEAPVUDRQ DXK DBPRIJJF YYRXZNPA FNDHKFE XFP NBTSI NYKKTVVE. TW BF RWI AOWUILMDOE ADQEPGL UV IYRYMJEK KTNB URI XIEFT FCKPMW JE XFTV GDN ORF MKEVVI LSSMU OGWO IFSR HPBCTUII IV C HDKYTWNETRA FPJESDE IJE URI EOAZMSXB KW BJQ QNDXFOQ QGC HKMB OGWO GWE ORY WYJSRIF CU ADKF RSHFIRXPJZ. URI EVCRGKP KIT NP XORNX BF CWYTKSMTXNJ CUUSVYINNWEWV NSUXSRATSUH JC JOM IFEIPTN CU LIHC GNUJPN NSWU DR VTQKH FVJYCWFU XJ PVZDYPRFX C PSE KIT FG XCHVCUI YH EOAZFIJDRO NPQXNIZ FG XWH. OJLWIXDZYZFBH FTV HJZXJACKH SRMKPYDAII I IFTS VNNFRFQD GSKYWTGF IJE AS DNPIW UV OGWO KYFPJAOE NVVN PRZTSQN WOYHDCYF SL EVZNAN EJFPJYYJZ. RIHP MKEVVIF YZ URI GADBJLI APGR D CCHP DFNFPNDO WUVVB, DXFVAO PKM YFTDJZV ZATX KTGR CSGJYO JMSWH TJ C NVQNZN, GF RWOP DBWQIY DS YFCCOP YUO ZPGFVNGN, CH TJ WWCI MIVKH UIEDMFZ, JOJFO EWZYXPJZH XORNX UDIVGDO NU. JONAO NH ZPNIM KXDBNZDK URWA MGCEW DND PV VELAF HNURLY DXK DIGFTQK UV YYJOYUTNN LXCU RWOP AKEVQN VJFBE WE MGCEW CZPMCUDCYF. (YW DE WETZK, URI NDTTWBCQC SL URWA ZYTF XWE ZSZ EBIGA PUUDP AGO CTZORWO GDQ YYNSHFIII.) DXKHS DZPDNDBLEPZ NP YPGNFTDDP, LACIFIH GZZ VWBLATDCM TKRDYZJVR. KGCRF JONAO CTS RJ AOJWIBE KW BJAONA DYJCIE MONPA WDDXFTDDNJ AD URI GADBJLI, AGO CEJLOTVZH JONC HFTWII LCZA XIHP JFU TFJWO TVIBNA, YUO DX RF LSJJI ZASIDYPN DXCU JORF XCO YIMKIK DECAGOY UVCV KW ZAS RNDHFTW. XFP GFETP QASSQQ DDSKFTJII MT ZAS WHNXNXS ENAO VDIXRNPRDIPB IDZJLI RZ NBF YWVVYU HJWAPV CU JON PJE WH XFP JNPSXNPJZA ZIYDPYZ, TRI MGCEW JJNPWHSB JZ NYZDRQ DS EJQVDSN YVQDRIJ KYFWYFCFP YH EKHNPA BRFDFTU WXKJM CTPUIJ UDJLJZYRJQXE. MGCEW DNPIW UV OGWO YFJLHPZ LTVQ AGO CTZORWO CTVYYJ NBF JLXP SL XDGAKMND’Q BNINB, AVENWOY ADD EODJFQDJAV JWEXRZPKO RLE LSYL TRI LO BDLI DZDFXSVNJ OHJUIYNO FG T ORRXRZ TGATQK IICDS HFTWLYR PUOSV MKZK PTQN IMJATRQPG NP JON AOMJVR GASSPU RRZOZFSR ALORXS. YYQSYUKRGDORZ, DX EPOTH JOGD NBF QOGJSG DIGFTQK PSXKKMQ BTD LC NBJQ DAIBK HKTZKMZJEK GAIKO DREOMYFZXRKJ NP JON AOMJVR, GZZ GF YIVTOHF JOGD CZH TGATSUH CWB GYHF ZCYDMNCKXNJ, YZ MSWED CUODVNNNRZ, JC AGO KXSRAF GKDULYR NF URI PTMWU XCHXZ GDI.
XFTV LDZX GXSUF ZCDXZ JDKDN NSUHDBNAYIMS IXMYYTTDEYOUU JC AGO SL ACOPMUNSRA IJE BS JNPG GF RWOP JF WFXRKJ IVJ XJ AOJWCQNZZ ZATX AGO WATBJL YYERLOP YUO TPV TNW PSXKKMQH QOJOGE CS EJOJE VF, LAF ZFEKQNZNW DEWVCVKO, ZPGFVNGDII, IJE, JH RNNOWHTVB, JOWUICBPZ, CPU LAF YWHSXE JCWQVDNJ SL. URLE AOVWIX EGSSMU WVFS YFCWRZ DRDQDRQCKO HCH I KKTDCI KW CU BIGFN WFLIYDT-LJLI BPYYH. XI KKPRO IIMKITFEB G SPIMDGGDCFP UWAP SL UXC AGSSHTRI IJE UXIYDT-LJLI GD OCTBLNFN. NP JON YOCPJLXP, CZ HRCDXZ IF FVNFOYXSB DFCUI JON GCMASDA FOJVILAC YHDDPGMGK; JJ EJOGE GVVX DXK NVDA NSTQICXTVNPA QGDOYJTP RQ CZ HRCDXZ LDBP RZNF FEIXC XCPUD.
"""

"""
Vigenere of Substitutions, keys: DCEOFGIAJSLMNPWQKTHUVXBYZR, TYZUSHARDGWBCEVFOIQJKLXPNM, WFGBIJKOLMNPQRCTUVDXYZESHA, GLMINPQFRCUVXYJZSHEADOKWBT, IMNJPQRGTUVXYZKSEAFDOWLBCH, YADZOWBXCEFGIJSKLMVNPQHRTU, CIJEKLMBNXQRTUFVPYWZSHGADO
REPORT ON THE ESTABLISHMENT, EFFECTIVENESS AND STANDING OF THE SHADOW ARCHIVE; WITH RECOMMENDATIONS. FOR YOUR EYES ONLY.
THIS REPORT WAS COMMISSIONED BY THE FOREIGN SECRETARY TO REPORT ON THE STRUCTURES AND ACTIVITIES OF THE QUASI-INDEPENDENT INTELLIGENCE AGENCY, THE SHADOW ARCHIVE, HEREAFTER REFERRED TO AS THE ARCHIVE. THE REPORT CONTAINS RECOMMENDATIONS FOR ACTIONS CONCERNING THE ARCHIVE, AS WELL AS A SUMMARY OF LESSONS LEARNED FROM ANALYSIS OF ITS ACTIVITIES. IT ALSO CONTAINS A BRIEF SUMMARY OF THE CURRENT ASSETS OF THE ARCHIVE AND RECOMMENDATIONS AS TO THE USE OR DISPOSAL OF THOSE ASSETS.
THE SHADOW ARCHIVE IS AN INDEPENDENT INTELLIGENCE AGENCY SET UP BY THE PRIVATE SECRETARY TO HER MAJESTY QUEEN VICTORIA IN THE LATE EIGHTEENTH CENTURY. IT WAS ESTABLISHED TO CONDUCT SURVEILLANCE AND TO CARRY OUT COVERT DIPLOMATIC ACTIONS DESIGNED TO FURTHER THE INTERESTS OF HER MAJESTY’S GOVERNMENT, WHILE PROVIDING AN ELEMENT OF PLAUSIBLE DENIABILITY IN THE EVENT THAT ITS ACTIVITIES WERE DISCOVERED. SCANT DOCUMENTATION STILL EXISTS FROM THIS STAGE OF THE ESTABLISHMENT OF THE ARCHIVE, THOUGH GIVEN THE DELICATE NATURE OF ITS OPERATIONS, IT MAY BE THAT VERY FEW SUCH DOCUMENTS WERE EVER WRITTEN. THE FEW THAT DO REMAIN ARE BY NATURE PRIVATE COMMUNICATIONS AND PERSONAL RECORDS.
IN PARTICULAR THERE APPEARS TO HAVE BEEN A CORRESPONDENCE BETWEEN HER MAJESTY AND CHARLES GREY CONCERNING THE NEED FOR SUCH AN ORGANISATION, THOUGH ONLY A FEW OF THOSE LETTERS ARE ON FILE IN THE PRIVATE ROYAL COLLECTION. IT IS SURMISED THAT OTHER LETTERS CONCERNING THE RECRUITMENT OF BLACK AS THE FIRST HEAD OF THE ARCHIVE MUST HAVE EXISTED, BUT AN ENTIRE BOX OF DOCUMENTS FROM THAT PERIOD IS MISSING WITH NO INDEX FILE TO TELL US WHAT IT CONTAINED. OUR INVESTIGATIONS INTO BLACK SHOW THAT HE WAS RELATED TO GREY, AND THAT HE RETURNED FROM BOSTON MASSACHUSETTS TO TAKE UP RESIDENCE IN LONDON. HIS IMMEDIATE FAMILY WERE NOT WEALTHY, THOUGH HE HAD BEEN A RELATIVELY SUCCESSFUL CRIMINAL IN THE UNITED STATES, AND CONTEMPORARY RECORDS SUGGEST THAT HE HAD ESTABLISHED INDEPENDENT MEANS. NO RECORD OF HIS EMPLOYMENT CAN BE FOUND, HOWEVER SEVERAL OF THE EXTANT DOCUMENTS FROM GREY’S PERSONAL COLLECTION HINT THAT BLACK WAS RECRUITED AS HER MAJESTY’S FIRST SECRET SECRETARY, SO THE ABSENCE OF ANY DOCUMENTATION IS UNSURPRISING. BLACK KEPT A PERSONAL JOURNAL WHICH CONTAINED SOME INTERESTING DETAILS, GIVING US SOME INSIGHT INTO HIS PERSONALITY, AND IT IS CLEAR THAT HE THRIVED ON ADVENTURE. UNFORTUNATELY, THE VOLUMES RELATING TO HIS PERIOD IN LONDON ARE ALSO MISSING, SO WE CANNOT RELY ON THEM TO FILL IN THE MISSING DETAILS OF HIS RECRUITMENT TO THE ARCHIVE. NONETHELESS A NUMBER OF UNOFFICIAL RECORDS MAINTAINED BY MEMBERS OF THE FOREIGN SECRETARY’S DEPARTMENT SUGGEST THAT THE EZISTENCE OF THE ARCHIVE, WHILE OFFICIALLY DENIED, WAS KNOWN TO A SMALL NUMBER OF MEMBERS OF THE INTELLIGENCE COMMUNITY IN LONDON. IN PARTICULAR THE ESTABLISHMENT OF HEADJUARTERS IN SCOTLAND YARD WAS A RELATIVELY OPEN SECRET, PRESUMABLY BECAUSE THE POLICE THEMSELVES WERE AWARE THAT SOMETHING UNUSUAL WAS GOING ON, THOUGH THE NAME AND ACTIVITIES OF THE ORGANISATION WERE A CLOSELY GUARDED SECRET. THE NAME SHADOW ARCHIVE DOES NOT APPEAR ON ANY OFFICIAL DOCUMENTS FROM THE PERIOD. AS THE SCALE OF BLACK’S OPERATIONS GREW IN THE MID EIGHTEEN SEVENTIES, RUMOURS OF ITS ACTIVITIES ALSO GREW AND IT SEEMS TO HAVE BEEN THIS, AS MUCH AS THE NEED TO ESTABLISH A SECURE LOCATION FOR HIS GROWING COLLECTION OF INTELLIGENCE PAPERS, THAT SEEMS TO HAVE LED BLACK TO THE DEVELOPMENT OF THE UNDERGROUND LABYRINTH BENEATH THE YARD. THE EXTRAORDINARY COST OF THIS COULD NOT BE PROPERLY CONCEALED AND THIS LED TO JUESTIONS IN THE HOUSE WHICH IN TURN, IF YOU WILL EXCUSE THE PUN, DROVE THE ARCHIVE FURTHER UNDERGROUND. THOSE GOVERNMENT MINISTRIES WHICH HAD HITHERTO BEEN BENEFICIARIES OF THE INTELLIGENCE DATA AND ANALYSIS PRODUCED BY BLACK’S OPERATIVES NOW COMPLETELY DISTANCED THEMSELVES, AND HE SEEMS TO HAVE BECOME AN ALMOST ENTIRELY FREE AGENT, SETTING HIS OWN POLITICAL AND DIPLOMATIC GOALS WITH THE TACIT SUPPORT OF THE PALACE. DURING THIS PERIOD, BLACK WAS FOCUSSED LARGELY ON DESTABILISING RUSSIAN, GERMAN AND AUSTRIAN IMPERIALIST EXPANSION IN THE BALKANS REGION, AND ON THE NEED TO PROTECT THE MEDITERRANEAN TRADE ROUTES. HE SEEMS TO HAVE DEVELOPED AN EXTENSIVE NETWORK OF AGENTS IN THE REGION, BUT MORE IMPORTANTLY TO HAVE DEVELOPED NEW METHODS OF WORKING. WHILE CLASSICAL DIPLOMACY HAD ALWAYS RELIED ON ESPIONAGE, BLACK ESTABLISHED NEW COVERT METHODS TO DISRUPT THE DIPLOMATIC ACTIVITIES OF POTENTIAL OPPOSITION, BY PLACING AGENTS WITHIN THEIR BUREAUCRACIES. CONTROLLING THE AGENDA OF IMPORTANT INTERNATIONAL MEETINGS, HE WAS ABLE, AT LEAST IN PART, TO CONTROL THE OUTCOME OF NEGOTIATIONS, AND TO BENEFIT FROM INSIDE KNOWLEDGE OF THOSE DELIBERATIONS. HE HAD PARTICULAR SUCCESS DURING THE PERIOD OF THE BULGARIAN AND BALKANS CRISES DISRUPTING THE ALLIANCE BUILDING BETWEEN THE THREE EMPERORS. IF HE HAD RESTRICTED HIMSELF TO ENGAGING WITH THE MAJOR POWERS IN THIS WAY HIS RECORD WOULD HAVE BEEN REGARDED AS A SIGNIFICANT SUCCESS AND THE SUBTLETY OF HIS METHODS MAY WELL HAVE WON HIM FRIENDS IN HIGH GOVERNMENT. THE SKILFUL WAY IN WHICH HE MANIPULATED INTERNATIONAL CONVENTIONS TO OUR BENEFIT AT VERY LITTLE COST IN LIVES PROMISED TO ESTABLISH A NEW WAY OF WORKING BY SUBTERFUGE INSTEAD OF WAR. UNFORTUNATELY HIS VICTORIES ENCOURAGED A MORE RECKLESS APPROACH AND HE SEEMS TO HAVE EXPLORED MORE EXTREME VERSIONS OF COVERT DIPLOMACY. HERE RECORDS AT THE ARCHIVE TELL A MORE COMPLETE STORY, THOUGH FOR REASONS THAT WILL BECOME CLEAR IN A MOMENT, WE HAVE CHOSEN TO REMOVE AND CLASSIFY, OR IN SOME CASES DESTROY, THOSE DOCUMENTS WHICH NARRATE IT. THERE IS CLEAR EVIDENCE THAT BLACK SET UP UNITS WITHIN THE ARCHIVE TO UNDERTAKE WHAT HAVE BECOME KNOWN AS BLACK OPERATIONS. (AS AN ASIDE, THE ETYMOLOGY OF THAT NAME WAS NOT CLEAR UNTIL THE ARCHIVE WAS UNCOVERED.) THESE SPECIALISED IN BLACKMAIL, BRIBERY AND POLITICAL AGITATION. WHILE THERE ARE NO RECORDS OF HIGHER CRIMES BEING AUTHORISED BY THE ARCHIVE, THE ACTIVISTS THEY WORKED WITH WERE NOT ABOVE MURDER, AND IT IS QUITE PROBABLE THAT THIS HAD BECOME ANOTHER TOOL OF THE NETWORK. THE LOCAL GROUPS SUPPORTED BY THE ARCHIVE WERE PARTICULARLY ACTIVE IN THE BALKAN STATES AT THE END OF THE NINETEENTH CENTURY, AND BLACK FOCUSSED ON TRYING TO DISRUPT RUSSIAN EXPANSION BY SOWING DISCORD AMONG BALKAN NATIONALISTS. BLACK SEEMS TO HAVE RETIRED FROM THE ARCHIVE AROUND THE TIME OF VICTORIA’S DEATH, HOWEVER HIS SUCCESSORS CONTINUED HIS WORK AND WE HAVE UNCOVERED EVIDENCE OF A HIGHLY ACTIVE GROUP WORKING UNDER CODE NAME ARCHANGEL IN THE REGION AROUND NINETEEN TWELVE. UNFORTUNATELY, IT SEEMS THAT THE SHADOW ARCHIVE NETWORK WAS BY THIS STAGE SUPPORTING ARMED INSURRECTION IN THE REGION, AND WE BELIEVE THAT ITS ACTIONS MAY HAVE CONTRIBUTED, AT LEAST INDIRECTLY, TO THE EVENTS LEADING TO THE FIRST WORLD WAR.
THIS FACT ALONE COULD CAUSE CONSIDERABLE EMBARRASSMENT TO THE UK GOVERNMENT AND WE FEEL WE HAVE NO OPTION BUT TO RECOMMEND THAT THE SHADOW ARCHIVE AND ALL ITS NETWORKS SHOULD BE WOUND UP, ITS DOCUMENTS ANALYSED, CLASSIFIED, AND, IF NECESSARY, DESTROYED, AND ITS ASSETS DISPOSED OF. THIS REPORT SHOULD ALSO REMAIN CLASSIFIED FOR A PERIOD OF AT LEAST SEVENTY-FIVE YEARS. WE WOULD RECOMMEND A PUBLICATION DATE OF TWO THOUSAND AND TWENTY-FIVE AT EARLIEST. IN THE MEANTIME, IT SHOULD BE PRESERVED USING THE HIGHEST SECURITY AVAILABLE; IT WOULD FORM THE MOST COMPROMISING MATERIAL IF IT SHOULD FALL INTO ENEMY HANDS.

"""

unformatted = Utils.unformat(text)


def positions():
    test_string = "EGF".lower()
    positions = []
    for i in range(0, len(unformatted)-len(test_string)):
        if unformatted[i:i+len(test_string)] == test_string: positions.append(i)
    print(positions)
    print([(positions[x]-positions[x-1]) for x in range(1, len(positions))])
    print([(positions[x]-positions[x-1])/7 for x in range(1, len(positions))])
    print(sum((lc.index(x)-lc.index(y)) % len(lc) for x, y in zip(test_string, 'the')))


columns = ["" for _ in range(7)]
for i in range(len(unformatted)):
    columns[i % len(columns)] += unformatted[i]


def gen_key(cipher: str) -> Dict[str, str]:
    global cipher_letter_order

    cipher_letter_order = ''.join(x[0] for x in sorted(Utils.frequency_count_letters(cipher).items(), key=lambda x: -x[1]))
    return {k: v for k, v in zip(cipher_letter_order, english_letter_order)}


def decode(columns: List[str], subs: List[Dict[str, str]]) -> str:
    solved = []
    for i in range(len(columns)):
        sol = Substitution.decode(columns[i], subs[i])
        solved.append(sol)

    result = ""
    for c_i in range(len(solved[0])):
        for section in solved:
            try: result += section[c_i]
            except IndexError: break
    return result


def hillclimb(cipher: List[str], pkey: List[Dict[str, str]], fitness=Utils.ngram_score, base_depth: int=500) -> (Dict[str, str], str):
    global cipher_letter_order
    pplain = decode(cipher, pkey)
    pscore = fitness(pplain)
    count = 0
    while count < base_depth:
        ckey = deepcopy(pkey)
        r = randrange(7)
        c, c2 = choice(cipher_letter_order), choice(cipher_letter_order)
        ckey[r][c], ckey[r][c2] = ckey[r][c2], ckey[r][c]
        cplain = decode(cipher, ckey)
        cscore = fitness(cplain)
        if not count % 100: print(count, end=" ")
        if cscore > pscore:
            pscore = cscore
            pkey = deepcopy(ckey)
            pplain = cplain
            print("\n%-*d %-*.2f" % (4, count, 20, pscore), pplain)
            count = 0
        count += 1
    return pkey, pplain


def print_with_numbs(result: str, r: int):
    result = result.strip()
    lines = []
    for i in range(0, len(result), 200):
        line = result[i:i + 200].replace("\n", " ")
        numbers = list((i) % 7 for i in range(len(line)))
        numbs = "".join(str(numbers.pop(0)) if line[i] in le else "." for i in range(len(line)))
        lines.append(numbs + "\n" + line + "\n")

    for line in lines[r:r+10]:
        print(line)
    if r == len(lines)-10: return True
    return False


def sorted_dict_str(dictionary: dict, sorting=lambda x: -x[1]) -> str:
    return "{" + ', '.join('"%s": "%s"' % (k, v) for k, v in sorted(dictionary.items(), key=sorting)) + "},\n"


def print_subs():
    print("[\n" + ''.join(sorted_dict_str(x, lambda y: ord(y[0])) for x in subs) + "\n]")


subs = [gen_key(col) for col in columns]
subs, result = hillclimb(columns, subs, base_depth=1000)

# subs = [
# {"a": "d", "b": "c", "c": "e", "d": "o", "e": "f", "f": "g", "g": "i", "h": "a", "i": "j", "j": "s", "k": "l", "l": "m", "m": "n", "n": "p", "o": "w", "p": "q", "q": "r", "r": "t", "s": "h", "t": "u", "u": "v", "v": "x", "w": "b", "x": "y", "y": "z", "z": "k"},
# {"a": "t", "b": "y", "c": "z", "d": "u", "e": "s", "f": "h", "g": "a", "h": "r", "i": "d", "j": "p", "k": "w", "l": "b", "m": "c", "n": "e", "o": "v", "p": "f", "q": "g", "r": "i", "s": "q", "t": "j", "u": "k", "v": "l", "w": "x", "x": "m", "y": "n", "z": "o"},
# {"a": "w", "b": "f", "c": "g", "d": "b", "e": "i", "f": "j", "g": "k", "h": "o", "i": "l", "j": "m", "k": "n", "l": "p", "m": "q", "n": "r", "o": "c", "p": "t", "q": "a", "r": "v", "s": "d", "t": "x", "u": "y", "v": "z", "w": "e", "x": "s", "y": "h", "z": "u"},
# {"a": "g", "b": "l", "c": "m", "d": "i", "e": "n", "f": "p", "g": "q", "h": "f", "i": "r", "j": "t", "k": "u", "l": "v", "m": "x", "n": "y", "o": "j", "p": "z", "q": "s", "r": "h", "s": "e", "t": "a", "u": "d", "v": "o", "w": "k", "x": "w", "y": "b", "z": "c"},
# {"a": "i", "b": "v", "c": "n", "d": "j", "e": "p", "f": "q", "g": "r", "h": "g", "i": "t", "j": "u", "k": "m", "l": "x", "m": "y", "n": "z", "o": "k", "p": "s", "q": "h", "r": "a", "s": "f", "t": "d", "u": "o", "v": "w", "w": "l", "x": "b", "y": "c", "z": "e"},
# {"a": "y", "b": "a", "c": "d", "d": "z", "e": "o", "f": "w", "g": "b", "h": "x", "i": "c", "j": "e", "k": "f", "l": "g", "m": "i", "n": "j", "o": "s", "p": "k", "q": "l", "r": "m", "s": "v", "t": "n", "u": "p", "v": "q", "w": "h", "x": "r", "y": "t", "z": "u"},
# {"a": "c", "b": "i", "c": "j", "d": "e", "e": "k", "f": "l", "g": "m", "h": "b", "i": "n", "j": "x", "k": "q", "l": "r", "m": "t", "n": "u", "o": "f", "p": "v", "q": "p", "r": "y", "s": "w", "t": "z", "u": "s", "v": "h", "w": "g", "x": "a", "y": "d", "z": "o"},
# ]

print_subs()
print(result)
print(Utils.reformat(result, text))

r = 0
inp = ""
print("Swap substitutions (q to end): ")
while inp != "q":
    result = decode(columns, subs)
    result = Utils.reformat(result, text)

    if print_with_numbs(result, r): inp = "q"
    print_subs()

    try:
        inp = input("n, a, b:\n  >")
        c, a, b = inp.split(" ")
        c = int(c)
        a = a.lower()
        b = b.lower()
    except ValueError:
        print("Moving on")
        r += 1
        continue

    print(c, a, b)
    subs[c][a], subs[c][b] = subs[c][b], subs[c][a]
    result = decode(columns, subs)
    result = Utils.reformat(result, text)

print_subs()
print(result)


# result = ''.join(text[i] if text[i] == result[i] else result[i].lower() for i in range(len(text)))

# html_base = ""
# for full_line in result.split("\n"):
#     for i in range(0, len(full_line), 200):
#         line = full_line[i:i+200].replace("\n", " ")
#         # print(" ", line)
#         numbers = list(i%7 for i in range(len(line)))
#         numbs = "".join(str(numbers.pop(0)+1) if line[i] in le else "." for i in range(len(line)))
#         print(numbs)
#         print(line)
#         print()
#         html_base += numbs + "<br>"
#         html_base += line + "<br><br>"
#
#
# html = """
# <!DOCTYPE html>
# <html lang="en">
#   <head>
#   </head>
#   <body style='font-family: monospace'>
#     %s
#   </body>
# </html>
#
# """ % html_base
# print(html)
# with open("partial.html", "w") as html_file:
#     html_file.write(html)